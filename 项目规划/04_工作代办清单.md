# Aiden-Lite 工作代办清单 (Task Breakdown)

## 📋 项目任务总览

### 快速导航
- [第一阶段: 项目基础](#第一阶段-项目基础)
- [第二阶段: AI 对话核心](#第二阶段-ai-对话核心)
- [第三阶段: 人脸识别](#第三阶段-人脸识别)
- [第四阶段: 日程管理](#第四阶段-日程管理)
- [第五阶段: 设备联动](#第五阶段-设备联动)

---

## 第一阶段: 项目基础 (1-2 周)

### 1.1 项目初始化
- [x] T1.1.1 - 创建 Python 虚拟环境 (venv/conda)
- [x] T1.1.2 - 初始化 requirements.txt 基础依赖
- [x] T1.1.3 - 创建 .env 模板文件与环境变量说明
- [x] T1.1.4 - 完善 .gitignore (Python、IDE、密钥文件)
- [x] T1.1.5 - 创建 README.md 项目快速开始指南

### 1.2 目录结构设计
- [x] T1.2.1 - 创建完整目录树 (已按 Web 架构重构)

### 1.3 FastAPI 框架搭建
- [x] T1.3.1 - 创建 main.py，初始化 FastAPI 应用
- [x] T1.3.2 - 配置 CORS 中间件
- [x] T1.3.3 - 创建基础 API 路由 (/, /video_feed, /logs)
- [x] T1.3.4 - 设置异常处理与退出机制

### 1.4 日志系统
- [x] T1.4.1 - 集成标准 logging 库
- [x] T1.4.2 - 配置日志级别与输出格式
- [x] T1.4.3 - 实现日志文件轮转与自动清理
- [ ] T1.4.4 - 添加性能分析日志
### 1.5 配置管理
- [x] T1.5.1 - 创建 config.py 统一管理配置
- [x] T1.5.2 - 支持从 .env.actual 读取配置

### 1.6 数据库初始化
- [x] T1.6.1 - 选择 SQLAlchemy ORM 配置
- [x] T1.6.2 - 连接 SQLite 数据库
- [x] T1.6.3 - 创建数据库初始化脚本
- [x] T1.6.4 - 实现数据库连接池

### 1.7 开发工具配置
- [x] T1.7.1 - 配置 black 代码格式化
- [x] T1.7.2 - 配置 flake8 代码检查
- [x] T1.7.3 - 配置 pytest 测试框架
- [x] T1.7.4 - 创建 pre-commit hooks

### 1.8 文档与示例
- [x] T1.8.1 - 编写项目快速开始文档
- [x] T1.8.2 - 编写开发环境搭建指南
- [x] T1.8.3 - 编写 API 基础文档框架

---

## 第二阶段: AI 对话核心 (3-10 周)

### 2.1 语音识别 (ASR) - 第 3-4 周
- [ ] T2.1.1 - 研究 faster-whisper 库
- [ ] T2.1.2 - 下载中文 Whisper 模型 (base / small)
- [ ] T2.1.3 - 创建 ASRModule 类框架
- [ ] T2.1.4 - 实现实时麦克风音频采集 (PyAudio)
- [ ] T2.1.5 - 实现音频流式处理
- [ ] T2.1.6 - 实现 faster-whisper 调用
- [ ] T2.1.7 - 添加多语言支持 (中英文自动检测)
- [ ] T2.1.8 - 性能优化 (量化模型、GPU 推理)
- [ ] T2.1.9 - 编写 ASR 单元测试
- [ ] T2.1.10 - **验收**: 能从麦克风识别语音为文字

### 2.2 文字转语音 (TTS) - 第 3-4 周
- [ ] T2.2.1 - 研究 edge-tts、pyttsx3
- [ ] T2.2.2 - 集成 edge-tts 作为主方案
- [ ] T2.2.3 - 创建 TTSModule 类框架
- [ ] T2.2.4 - 实现文本转语音基础功能
- [ ] T2.2.5 - 实现语音速度/音调控制
- [ ] T2.2.6 - 实现音频缓存机制
- [ ] T2.2.7 - 集成扬声器输出 (PyAudio)
- [ ] T2.2.8 - 多语言支持
- [ ] T2.2.9 - 编写 TTS 单元测试
- [ ] T2.2.10 - **验收**: 能将文字转语音并播放

### 2.3 音频处理优化
- [ ] T2.3.1 - 集成噪声抑制 (librosa/SpeechRecognition)
- [ ] T2.3.2 - 实现音量规范化
- [ ] T2.3.3 - 实现语音活动检测 (VAD)
- [ ] T2.3.4 - 实现自适应增益控制
- [ ] T2.3.5 - **验收**: 提升识别准确率 10%+

### 2.4 大模型 API 集成 - 第 5-6 周
- [ ] T2.4.1 - 获取 OpenAI API Key
- [ ] T2.4.2 - 创建 LLMClient 类
- [ ] T2.4.3 - 实现 GPT API 调用基础
- [ ] T2.4.4 - 实现参数配置 (temperature、top_p 等)
- [ ] T2.4.5 - 实现流式响应处理
- [ ] T2.4.6 - 实现备选大模型 (Claude、文心一言)
- [ ] T2.4.7 - 实现 Token 计数与成本估算
- [ ] T2.4.8 - 编写 LLM 测试用例
- [ ] T2.4.9 - **验收**: 能正确调用大模型并获得回复

### 2.5 Prompt 工程
- [ ] T2.5.1 - 设计系统 Prompt (AI 角色定义)
- [ ] T2.5.2 - 创建 Prompt 模板库 (YAML 配置)
- [ ] T2.5.3 - 编写不同场景的 Prompt
- [ ] T2.5.4 - 设计 Prompt 版本管理
- [ ] T2.5.5 - **验收**: AI 回复符合角色特性

### 2.6 对话管理系统 - 第 7-8 周
- [ ] T2.6.1 - 创建 ConversationManager 类
- [ ] T2.6.2 - 设计对话状态机
- [ ] T2.6.3 - 实现会话生命周期管理
- [ ] T2.6.4 - 创建 Conversation 数据库表
- [ ] T2.6.5 - 实现对话历史存储与查询
- [ ] T2.6.6 - 编写集成测试

### 2.7 记忆系统
- [ ] T2.7.1 - 创建 MemoryManager 类
- [ ] T2.7.2 - 设计长期记忆存储结构
- [ ] T2.7.3 - 设计短期记忆 (上下文窗口)
- [ ] T2.7.4 - 创建 Memory 数据库表
- [ ] T2.7.5 - 实现记忆检索与排序
- [ ] T2.7.6 - 实现记忆去重与更新
- [ ] T2.7.7 - **验收**: 能在多轮对话中保持记忆一致性

### 2.8 上下文管理
- [ ] T2.8.1 - 创建 ContextManager 类
- [ ] T2.8.2 - 实现上下文窗口管理 (Token 限制)
- [ ] T2.8.3 - 实现相关信息检索
- [ ] T2.8.4 - 实现上下文优先级排序
- [ ] T2.8.5 - **验收**: 在长对话中保持上下文相关性

### 2.9 唤醒词检测
- [ ] T2.9.1 - 研究本地唤醒词模型 (小爱、天猫精灵)
- [ ] T2.9.2 - 选择轻量级模型 (如 PocketSphinx)
- [ ] T2.9.3 - 创建 WakeWordDetector 类
- [ ] T2.9.4 - 实现连续唤醒词检测
- [ ] T2.9.5 - 实现自定义唤醒词学习
- [ ] T2.9.6 - 性能优化 (低 CPU 占用)
- [ ] T2.9.7 - **验收**: 低误触发率 (< 1%)

### 2.10 集成测试与优化 - 第 9-10 周
- [ ] T2.10.1 - 端到端流程测试 (语音 → 文字 → LLM → 语音)
- [ ] T2.10.2 - 性能基准测试 (延迟、CPU、内存)
- [ ] T2.10.3 - 压力测试 (多并发会话)
- [ ] T2.10.4 - 用户体验优化
- [ ] T2.10.5 - **验收**: 完成 3-5 轮自然对话

---

## 第三阶段: 人脸识别 (11-15 周)

### 3.1 摄像头驱动
- [x] T3.1.1 - 研究 OpenCV 摄像头支持
- [x] T3.1.2 - 创建 CameraModule 类
- [x] T3.1.3 - 实现多线程帧捕获，解决 Web 阻塞
- [x] T3.1.4 - 实现摄像头分辨率配置

### 3.2 人脸检测与识别
- [x] T3.2.1 - 集成 CompreFace SDK
- [x] T3.2.2 - 实现 1:N 实时搜索与相似度阈值过滤
- [x] T3.2.3 - 实现视觉标注增强 (PIL + OpenCV)
- [x] T3.2.4 - 实现智能日志冷却机制 (10秒防重复)

### 3.3 人脸库管理
- [ ] T3.4.1 - 实现人脸库添加接口
- [ ] T3.4.2 - 实现人脸库删除接口
- [ ] T3.4.3 - 实现人脸库查询接口
- [ ] T3.4.4 - 实现人脸库导入导出 (批量操作)
- [ ] T3.4.5 - 实现人脸库备份恢复

### 3.4 个性化问候 - 第 15 周
- [ ] T3.5.1 - 创建 User 与 UserInfo 数据库表
- [ ] T3.5.2 - 创建 Greeting 模板库
- [ ] T3.5.3 - 实现基于身份的问候生成
- [ ] T3.5.4 - 与 LLM 联动，生成自然问候
- [ ] T3.5.5 - 实现不同时间段的问候 (早上/中午/晚上)
- [ ] T3.5.6 - **验收**: 系统能自然地问候识别到的访客

### 3.5 Web 服务与界面
- [x] T3.5.1 - 选择并集成 FastAPI 框架
- [x] T3.5.2 - 实现 MJPEG 视频流接口
- [x] T3.5.3 - 实现 Server-Sent Events (SSE) 日志推送
- [x] T3.5.4 - 创建响应式暗色主题 HTML 界面
- [x] T3.5.5 - 实现优雅关闭机制 (避免 Ctrl+C 卡死)
- [x] T3.5.6 - 实现 Favicon 图标支持

---

## 第四阶段: 日程管理 (16-22 周)

### 4.1 日程 NLU 识别 - 第 16-17 周
- [ ] T4.1.1 - 研究中文时间实体识别 (Chinese NER)
- [ ] T4.1.2 - 集成 jieba + HanLP 进行分词
- [ ] T4.1.3 - 创建 ScheduleParser 类
- [ ] T4.1.4 - 实现时间实体识别 (何时)
- [ ] T4.1.5 - 实现事件名称提取 (做什么)
- [ ] T4.1.6 - 实现地点提取 (在哪里)
- [ ] T4.1.7 - 实现参与人提取 (谁参与)
- [ ] T4.1.8 - 实现相对时间转绝对时间 (明天 → 日期)
- [ ] T4.1.9 - 实现重复规则识别 (周一、每周)
- [ ] T4.1.10 - **验收**: 能准确解析日程语句

### 4.2 日程数据管理 - 第 18-19 周
- [ ] T4.2.1 - 创建 Schedule 数据库表
- [ ] T4.2.2 - 创建 ScheduleDB 操作类
- [ ] T4.2.3 - 实现日程创建接口
- [ ] T4.2.4 - 实现日程更新接口
- [ ] T4.2.5 - 实现日程删除接口
- [ ] T4.2.6 - 实现日程查询接口 (按日期、人员等)
- [ ] T4.2.7 - 实现冲突检测
- [ ] T4.2.8 - 实现日程导入 (iCal)
- [ ] T4.2.9 - 实现日程导出 (iCal)
- [ ] T4.2.10 - **验收**: 可完整管理日程

### 4.3 日程提醒 - 第 20-21 周
- [ ] T4.3.1 - 创建 Reminder 数据库表
- [ ] T4.3.2 - 创建 ScheduleReminder 类
- [ ] T4.3.3 - 使用 APScheduler 实现定时提醒
- [ ] T4.3.4 - 实现多时间点提醒 (1 小时前、30 分钟前、准时)
- [ ] T4.3.5 - 实现基于人脸识别的即时提醒
- [ ] T4.3.6 - 实现提醒内容生成
- [ ] T4.3.7 - 实现提醒音量、播放方式设置
- [ ] T4.3.8 - 实现已提醒标记
- [ ] T4.3.9 - **验收**: 准时精确提醒用户

### 4.4 日程优化 - 第 22 周
- [ ] T4.4.1 - 创建 ScheduleOptimizer 类
- [ ] T4.4.2 - 实现日程碎片整理 (合并相近日程)
- [ ] T4.4.3 - 实现行程路线优化
- [ ] T4.4.4 - 实现工作时间分析
- [ ] T4.4.5 - **验收**: 能为用户提出日程优化建议

---

## 第五阶段: 设备联动 (23-30 周)

### 5.1 MQTT 基础 - 第 23-24 周
- [ ] T5.1.1 - 研究 MQTT 3.1.1 协议
- [ ] T5.1.2 - 搭建本地 Mosquitto Broker
- [ ] T5.1.3 - 集成 paho-mqtt 库
- [ ] T5.1.4 - 创建 MQTTClient 类
- [ ] T5.1.5 - 实现自动重连机制
- [ ] T5.1.6 - 实现 TLS 加密支持
- [ ] T5.1.7 - 实现消息发布/订阅
- [ ] T5.1.8 - 实现消息保留 (Retain)
- [ ] T5.1.9 - 编写单元测试

### 5.2 设备管理 - 第 25 周
- [ ] T5.2.1 - 创建 Device 数据库表
- [ ] T5.2.2 - 创建 DeviceRegistry 类 (设备注册表)
- [ ] T5.2.3 - 实现设备发现 (MDNS、手动添加)
- [ ] T5.2.4 - 实现设备信息保存
- [ ] T5.2.5 - 实现设备状态同步
- [ ] T5.2.6 - 实现设备分类 (灯、温度计等)

### 5.3 指令执行 - 第 26 周
- [ ] T5.3.1 - 创建 CommandExecutor 类
- [ ] T5.3.2 - 定义标准指令格式 (开关灯、调温等)
- [ ] T5.3.3 - 实现通用开/关指令
- [ ] T5.3.4 - 实现调节类指令 (温度、亮度)
- [ ] T5.3.5 - 实现场景指令
- [ ] T5.3.6 - 编写指令执行测试

### 5.4 场景管理
- [ ] T5.4.1 - 创建 Scene 数据库表
- [ ] T5.4.2 - 创建 SceneManager 类
- [ ] T5.4.3 - 实现场景定义编辑
- [ ] T5.4.4 - 实现场景执行
- [ ] T5.4.5 - 实现常用场景预置 (出门、回家、睡眠)

### 5.5 米家集成 - 第 27-29 周
- [ ] T5.5.1 - 研究小米开放平台 API
- [ ] T5.5.2 - 获取开发者账号与授权
- [ ] T5.5.3 - 创建 MiHomeClient 类
- [ ] T5.5.4 - 实现用户授权流程
- [ ] T5.5.5 - 实现设备发现与同步
- [ ] T5.5.6 - 实现米家设备控制
- [ ] T5.5.7 - 实现房间/分区查询
- [ ] T5.5.8 - 实现设备分组查询
- [ ] T5.5.9 - 编写米家集成测试
- [ ] T5.5.10 - **验收**: 可控制米家设备，能获取房间信息

### 5.6 高级自动化 - 第 30 周
- [ ] T5.6.1 - 创建 Automation 数据库表
- [ ] T5.6.2 - 实现基于时间的自动化规则
- [ ] T5.6.3 - 实现基于条件的自动化规则 (温度、光线等)
- [ ] T5.6.4 - 实现规则优先级管理
- [ ] T5.6.5 - **验收**: 自动化规则能准确执行

---

## 后续阶段任务

### 第六阶段: 高级功能 (31-36 周)

#### 6.1 小爱同学集成 (31-32 周)
- [ ] T6.1.1 - 研究小爱同学 API/协议
- [ ] T6.1.2 - 实现需求分析 (何时调用小爱)
- [ ] T6.1.3 - 实现参数提取
- [ ] T6.1.4 - 实现小爱调用与结果反馈

#### 6.2 MCP 接口 (33-34 周)
- [ ] T6.2.1 - 学习 MCP 协议
- [ ] T6.2.2 - 实现 MCP 服务器框架
- [ ] T6.2.3 - 实现数据库查询工具
- [ ] T6.2.4 - 实现自定义命令工具
- [ ] T6.2.5 - 实现第三方 API 调用工具

#### 6.3 性能优化 (35 周)
- [ ] T6.3.1 - GPU 推理优化
- [ ] T6.3.2 - 模型量化与压缩
- [ ] T6.3.3 - 内存优化
- [ ] T6.3.4 - 响应时间优化

#### 6.4 安全加固 (36 周)
- [ ] T6.4.1 - 数据加密 (AES)
- [ ] T6.4.2 - 密钥管理
- [ ] T6.4.3 - API 权限控制
- [ ] T6.4.4 - 隐私保护 (GDPR 合规)
- [ ] T6.4.5 - 安全审计日志

---

## 优先级标记

- 🔴 **关键路径** (必须完成，阻塞其他任务)
- 🟡 **重要** (应该完成，优先级高)
- 🟢 **可选** (增强功能)

---

## 状态追踪

| 状态 | 含义 |
|------|------|
| ☐ | 待开始 |
| ◐ | 进行中 |
| ✓ | 已完成 |
| ✗ | 已取消 |
| ⚠️  | 被阻塞 |

